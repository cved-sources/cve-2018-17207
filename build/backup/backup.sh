#!/bin/bash

wp --path=/var/www/html/ plugin activate duplicator --allow-root

rm /var/www/html/wp-config.php

(sleep 20; rm -f /var/www/html/wp-config.php) &

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: application/json, text/javascript, */*; q=0.01' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' -H $'X-Requested-With: XMLHttpRequest' -H $'Content-Length: 195' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_ajax=1&action_step=1&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&archive_engine=ziparchive&exe_safe_mode=0&archive_filetime=current&logging=1&accpet-warnings=on' \
    $'http://127.0.0.1/installer.php'

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 200' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' -H $'Upgrade-Insecure-Requests: 1' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_step=2&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&logging=1&exe_safe_mode=0&retain_config=0&json=%257B%2522pass%2522%253A1%257D&json_debug_view=%7B%22pass%22%3A1%7D' \
    $'http://127.0.0.1/installer.php'

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: application/json, text/javascript, */*; q=0.01' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' -H $'X-Requested-With: XMLHttpRequest' -H $'Content-Length: 273' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_ajax=2&action_step=2&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&logging=1&dbaction=empty&dbhost=localhost&dbport=3306&dbname=wordpress&dbuser=root&dbpass=root&dbmysqlmode=DEFAULT&dbmysqlmode_opts=&dbcharset=utf8&dbcollate=utf8_general_ci' \
    $'http://127.0.0.1/installer.php'

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 371' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' -H $'Upgrade-Insecure-Requests: 1' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_step=3&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&logging=1&retain_config=0&exe_safe_mode=0&dbhost=localhost&dbport=3306&dbuser=root&dbpass=root&dbname=wordpress&json=%257B%2522pass%2522%253A1%252C%2522table_count%2522%253A13%252C%2522table_rows%2522%253A170%252C%2522query_errs%2522%253A0%257D&dbcharset=utf8&dbcollate=utf8_general_ci' \
    $'http://127.0.0.1/installer.php'

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: application/json, text/javascript, */*; q=0.01' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' -H $'X-Requested-With: XMLHttpRequest' -H $'Content-Length: 986' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_ajax=3&action_step=3&logging=1&retain_config=0&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&json=%257B%2522pass%2522%253A1%252C%2522table_count%2522%253A13%252C%2522table_rows%2522%253A170%252C%2522query_errs%2522%253A0%257D&dbhost=localhost&dbport=3306&dbuser=root&dbpass=root&dbname=wordpress&dbcharset=utf8&dbcollate=utf8_general_ci&exe_safe_mode=0&url_new=http%3A%2F%2F127.0.0.1&path_new=%2Fvar%2Fwww%2Fhtml%2F&blogname=CVED&wp_username=&wp_password=&siteurl=http%3A%2F%2F127.0.0.1&url_old=http%3A%2F%2F127.0.0.1&path_old=%2Fvar%2Fwww%2Fhtml%2F&tables%5B%5D=wp_commentmeta&tables%5B%5D=wp_comments&tables%5B%5D=wp_duplicator_packages&tables%5B%5D=wp_links&tables%5B%5D=wp_options&tables%5B%5D=wp_postmeta&tables%5B%5D=wp_posts&tables%5B%5D=wp_term_relationships&tables%5B%5D=wp_term_taxonomy&tables%5B%5D=wp_termmeta&tables%5B%5D=wp_terms&tables%5B%5D=wp_usermeta&tables%5B%5D=wp_users&plugins%5B%5D=duplicator%2Fduplicator.php' \
    $'http://127.0.0.1/installer.php'

curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1' -H $'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: en-US,en-US;q=0.7,en;q=0.3' -H $'Accept-Encoding: gzip, deflate' -H $'Referer: http://127.0.0.1/installer.php' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 909' -H $'DNT: 1' -H $'Connection: close' -H $'Cookie: wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' -H $'Upgrade-Insecure-Requests: 1' \
    -b $'wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_4411def9d576984c8d78253236b2a62f=cved%7C1548966080%7CTwUVti19lOUmTDrAN4kbufAi8YTY9vlzWUN186pyKVl%7C65b7fd9c18dbfde9b078de93d1e83cce0e9ced38f99cb37def07e78a07e0fe49; wp-settings-time-1=1548793360' \
    --data-binary $'action_step=4&archive_name=20190129_cved_7db52744291373ed2504190129202234_archive.zip&retain_config=0&exe_safe_mode=0&url_new=http%3A%2F%2F127.0.0.1&json=%257B%2522step2%2522%253A%257B%2522pass%2522%253A1%252C%2522table_count%2522%253A13%252C%2522table_rows%2522%253A170%252C%2522query_errs%2522%253A0%257D%252C%2522step3%2522%253A%257B%2522scan_tables%2522%253A13%252C%2522scan_rows%2522%253A144%252C%2522scan_cells%2522%253A670%252C%2522updt_tables%2522%253A0%252C%2522updt_rows%2522%253A0%252C%2522updt_cells%2522%253A0%252C%2522errsql%2522%253A%255B%255D%252C%2522errser%2522%253A%255B%255D%252C%2522errkey%2522%253A%255B%255D%252C%2522errsql_sum%2522%253A0%252C%2522errser_sum%2522%253A0%252C%2522errkey_sum%2522%253A0%252C%2522time%2522%253A%25220.0119%2520sec.%2522%252C%2522err_all%2522%253A0%252C%2522warn_all%2522%253A0%252C%2522warnlist%2522%253A%255B%255D%252C%2522pass%2522%253A1%257D%257D' \
    $'http://127.0.0.1/installer.php'
